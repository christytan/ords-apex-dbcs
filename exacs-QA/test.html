<html>
    <head>
        <link rel="stylesheet" href="#APP_IMAGES#code.css" type="text/css">
    </head>
<table class="tbl-heading" class="td-logo">
        <tr>    
            <td><img src="./images/obe_tag.png" alt=""><br/>
                Apr 19, 2020
            </td>
            <td class="td-banner">
                # Lab 8: Migrating to Exadata Cloud Service using Data Pump
            </td>
        </tr>
    </table>
    
    <h1>Lab 8: Migrating to Exadata Cloud Service using Data Pump</h1>
    <p>To <strong>log issues</strong>, click <a href="https://github.com/oracle/learning-library/issues/new">here</a> to go to the github oracle repository issue submission form.</p>
    <h2>Introduction</h2>
    <p>Oracle Data Pump offers very fast bulk data and metadata movement between user managed Oracle databases and Exadata Cloud Service Databaes.</p>
    <p>Data Pump Import lets you import data from Data Pump files. You can save your data to either the database server or File Storage Server and use Oracle Data Pump to load data to Exadata Cloud Service Database.</p>
    <p>This lab walks you through the steps to migrate a sample application schema using datapump import into your exadata cloud service database.</p>
    <h2>Objectives</h2>
    <p>As a database admin or user,</p>
    <ol>
    <li>Download a sample datapump export dump file from Oracle Learning Library github repository.</li>
    <li>Secure copy the dump file to the exadata machine to the required directory and run import data pump</li>
    </ol>
    <h2>Required Artifacts</h2>
    <ul>
    <li>An Oracle Cloud Infrastructure account with privileges to create object storage buckets and dedicated autonomous databases.</li>
    <li>Access to a pre-provisioned Exadata cloud servicedatabase . Refer to <a href="f?p=&APP_ID.:9:&SESSION.">Lab 4</a></li>
    <li>A pre-provisioned instance of Oracle Developer Client image in an application subnet. Refer to <a href="./ConfigureDevClient.md">Lab 6</a></li>
    </ul>
    <h2>Steps</h2>
    <h3>STEP 1: Download sample data pump export file from Oracle Learning Library github repo</h3>
    <ul>
    <li>Log into your bastion server</li>
    </ul>
    <pre><code>ssh -i &lt;private_key&gt; opc@&lt;public_IP_address&gt;
    </code></pre>
    <p><img src="#APP_IMAGES#/bastion_login.png" alt="bastion_login"></p>
    <ul>
    <li>Create a folder on your bastion server as your user_number</li>
    </ul>
    <pre><code>cd dump_file
    mkdir user_XX
    cd user_XX
    </code></pre>
    <p><img src="#APP_IMAGES#/cd_dump_file.png" alt="cd_dump_file"></p>
    <p><img src="#APP_IMAGES#/mkdir_user_dump.png" alt="mkdir_user_dump"></p>
    <ul>
    <li>Use the following command in your folder on bastion server and download a sample schema dump from OLL</li>
    </ul>
    <pre><code>wget -O user_01.dmp https://objectstorage.us-ashburn-1.oraclecloud.com/p/LdwVJ20TfCaQGHwH_fhi8xPRLZldM-QasPN2pjquak8/n/orasenatdpltintegration02/b/ExaCSScripts/o/data_pump_nodeapp.dmp
    </code></pre>
    <p><img src="#APP_IMAGES#/wget_dump.png" alt="wget_dump">
    <img src="#APP_IMAGES#/wget_dump_details.png" alt="wget_dump_details">
    <img src="#APP_IMAGES#/dump_complete.png" alt="dump_complete"></p>
    <h3>STEP 2: Setup environment to import data to Exadata Cloud Service Database</h3>
    <ul>
    <li>Log into your database from your bastion server and execute following command</li>
    </ul>
    <pre><code>ssh -i &lt;/path/to/identity/file&gt; oracle@&lt;exadata_node&gt;
    source userXX
    sqlplus system/&lt;system_password&gt;@usr_xx
    </code></pre>
    <pre><code>set lines 500
    column directory_name format a45
    column directory_path format a95
    
    select directory_name, directory_path from all_directories order by 1
    /
    </code></pre>
    <p><img src="#APP_IMAGES#/all_db_dir.png" alt="all_db_dir">
    <strong>NOTE</strong>: Make sure directory <em><strong>DATA_PUMP_DIR</strong></em> exists and copy the path</p>
    <ul>
    <li>Secure copy the dump file to the oracle exadata cloud service server to the data pump directory that you have noted down before</li>
    </ul>
    <pre><code>scp -i &lt;/path/to/identity/file&gt; user_xx.dmp oracle@&lt;Exadata_private_ip&gt;:&lt;/path/to/DATA_PUMP_DIR&gt;
    </code></pre>
    <h3>STEP 3: Perform Data Import</h3>
    <ul>
    <li>Log into the exadata cloud service DB server</li>
    </ul>
    <pre><code>ssh -i &lt;/path/to/identity/file&gt; oracle@&lt;exadata_node&gt;
    source userXX
    </code></pre>
    <p><em><strong>NOTE:</strong></em> Login to Node of Exadata and make a TNS entry on your tnsnames.ora file such that your import data pump process only uses this particular node as we are placing the dump file on only one node and not on a shared file system.</p>
    <pre><code>cd $ORACLE_HOME/network/admin/user_xx/
    vi tnsnames.ora
    </code></pre>
    <pre><code>usrxx_1 =
      (DESCRIPTION =
        (ADDRESS = (PROTOCOL = TCP)(HOST = &lt;exa_node_1&gt;.&lt;subnet&gt;.&lt;vcn&gt;.oraclevcn.com)(PORT = 1521))
        (CONNECT_DATA =
          (SERVER = DEDICATED)
          (SERVICE_NAME = usrxx..&lt;subnet&gt;.&lt;vcn&gt;.exavcn.oraclevcn.com)
          (FAILOVER_MODE =
            (TYPE = select)
            (METHOD = basic)
          )
        )
      )
    
    </code></pre>
    <ul>
    <li>Finally, the stage is set to run the import command from your dev client bash prompt</li>
    </ul>
    <pre><code>$ impdp system/&lt;PASSWORD&gt;@&lt;usr_XX&gt; directory=DATA_PUMP_DIR dumpfile=user_xx.dmp 
    </code></pre>
    <ul>
    <li>In the above command, replace
    <ul>
    <li><strong>password</strong> - Admin password for your database system user</li>
    <li><strong>usr_XX</strong> - The pluggable database that you created</li>
    <li><strong>directory</strong> - leave as shown above</li>
    <li><strong>dumpfile</strong> -  The dump file that was secure copied to the directory location</li>
    </ul>
    </li>
    </ul>
    <p><img src="#APP_IMAGES#/impdp_log.png" alt="impdp_log"></p>
    <p><strong>For more information on Oracle Data Pump, please refer to the <a href="https://docs.oracle.com/en/database/oracle/oracle-database/19/sutil/oracle-data-pump.html#GUID-501A9908-BCC5-434C-8853-9A6096766B5A">documentation</a></strong></p>
    <p>All Done! Your application schema was successfully imported.</p>
    <p>You may now connect to your exadata cloud service database using a SQL client and validate import.</p>
    <table class="tbl-heading" class="td-logo">
            <tr>    
                <td><img src="./images/obe_tag.png" alt=""><br/>
                    Apr 19, 2020
                </td>
                <td class="td-banner">
                    ### Congratulations! You have successfully completed migration of an Oracle database to the Exadata Cloud Service Database using Data Pump
                </td>
            </tr>
        </table>
</html>